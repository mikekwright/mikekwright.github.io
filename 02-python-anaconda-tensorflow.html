
<!DOCTYPE html>
<html lang="en">
<head>
  <link href='//fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700,400italic' rel='stylesheet' type='text/css'>

    <link rel="stylesheet" type="text/css" href="http://mikewright.me/theme/stylesheet/style.min.css">

  <link rel="stylesheet" type="text/css" href="http://mikewright.me/theme/pygments/github.min.css">
  <link rel="stylesheet" type="text/css" href="http://mikewright.me/theme/font-awesome/css/font-awesome.min.css">


    <link href="http://mikewright.me/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Mike's Dev / Data Science Blog Atom">


    <link rel="shortcut icon" href="http://mikewright.me/images/favicon.jpg" type="image/x-icon">
    <link rel="icon" href="http://mikewright.me/images/favicon.jpg" type="image/x-icon">

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="index, follow" />


<meta name="author" content="Michael Wright" />
<meta name="description" content="This was the day that I took the time to get myself not only more familiar with Anaconda, but to also create a reusabled docker image." />
<meta name="keywords" content="python">
<meta property="og:site_name" content="Mike's Dev / Data Science Blog"/>
<meta property="og:title" content="Python, Anaconda and Tensorflow"/>
<meta property="og:description" content="This was the day that I took the time to get myself not only more familiar with Anaconda, but to also create a reusabled docker image."/>
<meta property="og:locale" content="en_US"/>
<meta property="og:url" content="http://mikewright.me/02-python-anaconda-tensorflow.html"/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content="2016-11-11 14:00:00-07:00"/>
<meta property="article:modified_time" content=""/>
<meta property="article:author" content="http://mikewright.me/author/michael-wright.html">
<meta property="article:section" content="development"/>
<meta property="article:tag" content="python"/>
<meta property="og:image" content="http://mikewright.me/images/avatar.jpg">

  <title>Mike's Dev / Data Science Blog &ndash; Python, Anaconda and Tensorflow</title>
</head>
<body>
  <aside>
    <div>
      <a href="http://mikewright.me">
        <img src="http://mikewright.me/images/avatar.jpg" alt="Love 2 Code" title="Love 2 Code">
      </a>
      <h1><a href="http://mikewright.me">Love 2 Code</a></h1>


      <nav>
        <ul class="list">
          <li><a href="http://mikewright.me/pages/about.html#about">About</a></li>
          <li><a href="http://mikewright.me/pages/contact.html#contact">Contact</a></li>
          <li><a href="http://mikewright.me/pages/experience.html#experience">Experience</a></li>

        </ul>
      </nav>

      <ul class="social">
        <li><a class="sc-linkedin" href="https://www.linkedin.com/in/mikekwright" target="_blank"><i class="fa fa-linkedin"></i></a></li>
        <li><a class="sc-github" href="https://github.com/mikekwright" target="_blank"><i class="fa fa-github"></i></a></li>
        <li><a class="sc-twitter" href="https://twitter.com/mikekwright" target="_blank"><i class="fa fa-twitter"></i></a></li>
      </ul>
    </div>
  </aside>
  <main>
    <nav>
      <a href="http://mikewright.me">    Home
</a>

      <a href="/archives.html">Archives</a>
      <a href="/categories.html">Categories</a>
      <a href="/tags.html">Tags</a>

      <a href="http://mikewright.me/feeds/all.atom.xml">    Atom
</a>

    </nav>

<article class="single">
  <header>
    <h1 id="02-python-anaconda-tensorflow">Python, Anaconda and Tensorflow</h1>
    <p>
          Posted on Fri 11 November 2016 in <a href="http://mikewright.me/category/development.html">development</a>


    </p>
  </header>
  <div>
    <p>So I have used python in the past, but generally my experiences with python have
been limited to either small sinatra scripts and other cli tools.  With my new
position though, I have needed to get more familiar with the python ecosystem.   </p>
<p>One of the tools that at least a number of other engineers on my team are using is
<a href="https://www.continuum.io/downloads">anaconda</a>.  </p>
<h2>Overview</h2>
<p>I have used python dependencies before, however up until this point that has been 
limited to both virtualenv and pip.  I really enjoyed the system and the ability
to be able to quickly and easily install the dependencies that I needed using
<code>pip install &lt;dependency&gt;</code>.  </p>
<p>Once I got to the position of needing many dependencies and running them on different
machines I got use the requirements files <code>pip install -r requirements.txt</code>.   </p>
<p>Both of these systems would work well, however I noticed myself sometimes running
into systems that were failing because of OS dependencies that were missing.  This 
was never more present then when I started to install some of the DataScience tools. </p>
<h2>Anaconda</h2>
<p>It was a this point that I stumbled across Anaconda.  I was quite surprised by this library
and the ease at which it was to create environments, so long as I was in <code>bash</code> or <code>zsh</code>. 
The installation itself was painless and straightforward.  However what I really wanted
was the ability to define the different dependencies that I needed and to have those
be quickly enabled within anaconda.  Luckily this was easily accomplished using the 
environment file format.   </p>
<div class="highlight"><pre><span></span><span class="n">name</span><span class="o">:</span> <span class="n">myenv</span>
<span class="n">dependencies</span><span class="o">:</span>
  <span class="o">-</span> <span class="n">numpy</span>
  <span class="o">-</span> <span class="n">jupyter</span>
</pre></div>


<p>So once I had this file created I was able to create and use this file to both create the
virtual environment and install the dependencies in the environment, using this command.  </p>
<div class="highlight"><pre><span></span>    conda env create -f environment.yml
</pre></div>


<p>Now there was one issue that I ran into, and that was the desire to install a dependency
that did not have an existing conda package.  I found that I could still install dependencies
to the system using pip.   </p>
<div class="highlight"><pre><span></span>    name: myenv
    dependencies:
      - numpy
      - jupyter
      - pip
      - pip:
        - https://storage.googleapis.com/tensorflow/linux/cpu/tensorflow-0.11.0-cp35-cp35m-linux_x86_64.whl
</pre></div>


<h2>Dockerize It</h2>
<p>So for me, that last part was being able to get the above system working correctly with
a docker container. Luckily this was a very straight forward process, even allowed me to
easily install python3.5 on ubuntu 14.04.   </p>
<div class="highlight"><pre><span></span>    FROM ubuntu:16.04

    RUN apt-get update &amp;&amp; \
        apt-get install -y curl build-essential &amp;&amp; \
        apt-get clean &amp;&amp; \
        rm -rf /tmp/ /var/tmp/ /var/lib/apt/lists/*
</pre></div>


<p>This is just the basic system installing the curl command (needed to pull down the anaconda installer)
and the build tools (aka gcc).  </p>
<div class="highlight"><pre><span></span>    RUN curl -sSL -o installer.sh https://repo.continuum.io/archive/Anaconda3-4.2.0-Linux-x86_64.sh &amp;&amp; \
        bash /installer.sh -b -f &amp;&amp; \
        rm /installer.sh
</pre></div>


<p>In the above snippet I am actually pulling down the file and installing it.  The reason I chose to
use curl instead of the docker <code>ADD</code> command is that I wanted to keep the layers as thin as possible.   </p>
<p>The other thing to note is the <code>-b</code> and <code>-f</code> options that are supplied with the installer.  These allow
for us to run the installer without needing tty access by using the defaults for the installer (including
the prefix which puts anaconda at <code>/root/anaconda3</code>).   </p>
<div class="highlight"><pre><span></span><span class="x">    ENV PATH &quot;</span><span class="p">$</span><span class="nv">PATH</span><span class="x">:/root/anaconda3/bin&quot;</span>
<span class="x">    ADD startup /startup</span>

<span class="x">    EXPOSE 8888 6006</span>
<span class="x">    VOLUME /notebooks</span>
<span class="x">    WORKDIR &quot;/notebooks&quot;</span>

<span class="x">    CMD [&quot;jupyter&quot;, &quot;notebook&quot;, &quot;--port=8888&quot;, &quot;--no-browser&quot;, &quot;--ip=0.0.0.0&quot;]</span>
</pre></div>


<p>Here we are setting up the anaconda information for the system, including some exposed ports with 
<code>8888</code> being the main port for the notebook. We also set our default commands to startup
the jupyter notebook allowing access from non-localhost machines (which of course is needed since
it is running in a container).   </p>
<div class="highlight"><pre><span></span>    ADD environment.yml /environment.yml
    RUN conda env create -f /environment.yml
    ENV CONDA_ENV tensorflow
</pre></div>


<p>These final 3 values are useful as they allow use to create onbuild versions of the same dockerfile
that will allow others to specify the environment dependencies.  </p>
<h2>Conclusion</h2>
<p>I really enjoyed using anaconda and the ease that it gave me in setting up some custom python
environments.  I have already moved most of the existing machines that I have over to anaconda and
am sure that I will find many more reasons to enjoy it.  </p>
<p>If you are interested in checking out either the docker image or the repo with the Dockerfile, links 
can be found below.  </p>
<ul>
<li><a href="https://github.com/mikekwright/docker-anaconda-tensorflow/blob/master/Dockerfile">Dockerfile</a></li>
<li><a href="https://hub.docker.com/r/mikewright/anaconda-tensorflow/">Docker Images</a> </li>
</ul>
  </div>
  <div class="tag-cloud">
    <p>
      <a href="http://mikewright.me/tag/python.html">python</a>
    </p>
  </div>



</article>

    <footer>
<p>&copy; Michael Wright 2016</p>
<p>    Powered by <a href="http://getpelican.com" target="_blank">Pelican</a> - <a href="https://github.com/alexandrevicenzi/flex" target="_blank">Flex</a> theme by <a href="http://alexandrevicenzi.com" target="_blank">Alexandre Vicenzi</a>
</p>    </footer>
  </main>





<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " Mike's Dev / Data Science Blog ",
  "url" : "http://mikewright.me",
  "image": "http://mikewright.me/images/avatar.jpg",
  "description": "Simple blog created for discussing different topics around development and data science"
}
</script>
</body>
</html>