

<!doctype html>
  <!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
  <!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
  <!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
  <!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>EC2 Container Service - My Fortress of Solitude</title>
    <meta name="author" content="Michael Wright">
    
    <meta name="description" content="EC2 Container Service Dec 1st, 2014 AWS EC2 Cloud Docker At AWS re:Invent (November 2014) a new technology was introduced. This was the AWS EC2 &hellip;">
    
    <meta name="viewport" content="width=device-width">
    
    <link rel="canonical" href="http://www.mikewright.me/blog/2014/12/01/ec2-container-service">
    <link href="/favicon.png" rel="icon">
    <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet">
    <link href="//atom.xml" rel="alternate" title="My Fortress of Solitude" type="application/atom+xml">
  </head>


  <body >

    <header>
      <div class="grid-wrapper">
  <div class="grid">

    <div class="grid__item two-fifths lap-four-sixths palm-one-whole">
  <a href="/" class="site-title">My Fortress of Solitude</a>
</div>

<div class="grid__item three-fifths lap-two-sixths palm-one-whole">
  <nav>
    <input type="checkbox" id="toggle">
<label for="toggle" class="toggle" data-open="Main Menu" data-close="Close Menu"></label>
<ul class="menu pull-right">
  <li><a href="/">Home</a></li>
  <li><a href="/blog/">Blog</a></li>
</ul>
  </nav>
</div>

  </div>
</div>
    </header>

    

    <div class="grid-wrapper">
      <div class="grid grid-center">
        
        <div class="grid__item two-thirds lap-one-whole palm-one-whole">
        

          <article class="post">
  <header>
  
  <h1 class="title indent">EC2 Container Service</h1>
  

  
  <div class="meta clearfix">
    








  


<time class="pull-left" datetime="2014-12-01T11:18:00-07:00" pubdate data-updated="true"><i class="icon-calendar"></i> Dec 1<span>st</span>, 2014</time>
    



  
  <div class="pull-left">
    <i class="icon-tags"></i>
    <ul class="tags unstyled">
    
      <li><a href="/blog/categories/AWS/">AWS</a></li>
    
      <li><a href="/blog/categories/EC2/">EC2</a></li>
    
      <li><a href="/blog/categories/Cloud/">Cloud</a></li>
    
      <li><a href="/blog/categories/Docker/">Docker</a></li>
    
    </ul>
  </div>
  

    
  </div>
  
</header>




  <p>At AWS re:Invent (November 2014) a new technology was introduced. This was the AWS EC2
Container Service.  A service provided by AWS to run docker containers on top of EC2 instances.</p>

<!-- more -->


<p>We have been using docker for a while now within our organization, and I have to say that I
am a huge fan of Docker.  This is a great step in the right direction and I believe can help
to decrease deploys to AWS while increasing stability and extensibility of a given architecture.</p>

<h2>EC2 Container Service</h2>

<p>At this point in time EC2 Container Service is still in preview, which means that you will need
to request access to this preview in your own AWS account to follow this pattern.  However
AWS does have some great material that will allow you to see the benefits of this new service
without requiring you to have preview access.  This material can be found
<a href="http://aws.amazon.com/ecs/getting-started/">here</a>.</p>

<h2>Service Breakdown</h2>

<p>The main idea of this service is to give you the ability to create complese architectures that
can be broken down into smaller docker containers, which in turn can be deployed to a cluster
of actual ec2 instances.  This meanst hat you could have a single m3.xlarge instance for your
application while keeping the database and application code seperate, but without requiring you
to have more instances than absolutely necessary.</p>

<p>The service pieces are broken down into the following.</p>

<ol>
<li>Tasks</li>
<li>Containers</li>
<li>Clusters</li>
<li>Container Instances</li>
</ol>


<h3>Tasks</h3>

<p>Tasks are basically the starting point of your cluster deploy.  Anytime you want to deploy
your application you will start by defining the task.  Tasks themselves are defined as json
objects.</p>

<pre><code>{
  "family": "application-name",
  "version": "9a56714245e7e603127",    -- This can be a simple version or git SHA1
  "containers": [
    &lt;&lt; CONTAINER DEFINITIONS &gt;&gt;
  ]
}
</code></pre>

<p>So with this json definition we are defining the entire application that we are providing,
so if I had an application that acted as an API endpoint I would provide the load balancing
server as a container, the actual web server as a container and then a container for the
database (if one exists).</p>

<p>When you have your task defined, you can register that task with EC2 Container Service
to specify that you have the new task.</p>

<pre><code>aws ecs register-task-definition --family "custom-name" --version "custom-version" definition.json
</code></pre>

<p>After you have registered the task and you have the cluster created you can run the
task using the following command.</p>

<pre><code>aws ecs run-task custom-name:custom-version    
</code></pre>

<h3>Containers</h3>

<p>Container definitions are very simple and can follow a lot of the docker idioms in creation.</p>

<pre><code>{
  "name": "container-name", 
  "image": "app-container:latest", 
  "cpu": 128,                        -- Note CPU is in units, defines the instances that can fit a given instance
  "memory": 512,
  "portMappings": [
    {
      "containerPort": 9443, 
      "hostPort": 443 
    }
  ], 
  "links": ["frontend"], 
  "essential": true
}
</code></pre>

<p>So the main things to understand on this definition is the <code>cpu</code> field.  This represents the
unit of measurement for a cpu that should be used.  You can think of this as almost a percentage
of the total CPU to use (which I believe 100% would be 1024).  So if I wanted to use 50% of the
cpu for a given instance I would have <code>"cpu": 512</code>.</p>

<p>The links is the list of containers that this container should reference, you can find information
about linking containers on the docker documentation site.</p>

<p>Finally the essential flag is set to let the cluster know if the task is basically good or not.
If a single container is essential, but cannot be created or fails to run, this would mean the
task is not valid anymore.</p>

<h3>Clusters</h3>

<p>Clusters are basically grouping of container instances that are releated for a given task.  When
the cluster is first created it is empty and it then populates with container as requirements
come into play.</p>

<p>AWS does have a command line tool that you can use to create a cluster.</p>

<pre><code>aws ec2 create-cluster cluster-name
</code></pre>

<p>This will create a cluster an give you the ability to start creating container instances that
can be part of this cluster.   When this cluster is created you will be given an <code>arn</code> to
reference this cluster. This is a very similar process to SQS, SNS, etc.</p>

<h3>Container Instances</h3>

<p>These are instances that AWS have setup with a <code>go</code> application (container agent) that will
tie into the cluster mechanism.</p>

<h2>Conclusion</h2>

<p>While I have not yet been able to test out ECS I am very excited about this service and
very excited about the flow they have created as I feel that it allows us to create much more
stable and scalable systems.</p>

<p>Once I have access to the preview I will add my experiences in a follow-up post.</p>


</article>

 
<section id="disqus">
  <h1 class="indent title">Comments</h1>
  <div id="disqus_thread" aria-live="polite"><div id="disqus_thread"></div>
<script type="text/javascript">
  /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
  var disqus_shortname = 'wrightcoder'; // required: replace example with your forum shortname

  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>

<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    
</div>
</section>

        
        </div>
        
        
        <aside id="sidebar" class="grid__item one-third lap-one-whole palm-one-whole">
          <div class="grid">

  
<section class="social aside-module grid__item one-whole lap-one-half">
  <h1 class="title delta">
    Track my Movements
  </h1>
  <ul class="unstyled">
    
    
    <li><a class="github" href="//github.com/wrightcoder"><i class="icon-github"></i> Github</a></li>
    
    <li><a class="gplus" href="//plus.google.com/118232506537372838088"><i class="icon-google-plus-sign"></i> Google+</a></li>
    <li><a class="linkedin" href="//linkedin.com/in/weijiajun"><i class="icon-linkedin-sign"></i> LinkedIn</a></li>
    
    <li><a class="stackoverflow" href="//stackoverflow.com/users/310561"><i class="icon-stackexchange"></i> StackOverflow</a></li>
    <li><a class="twitter" href="//twitter.com/mk_wright"><i class="icon-twitter"></i> Twitter</a></li>
    <li><a class="youtube" href="//youtube.com/user/weijiajun"><i class="icon-youtube"></i> YouTube</a></li>
  </ul>
</section>


  <section id="recent-posts" class="aside-module grid__item one-whole lap-one-half">
  <h1 class="title delta">Recent Posts</h1>
  <ul class="divided">
    
      <li class="post">
        <a href="/blog/2015/10/12/lets-do-some-weld-ing/">Let's do some Weld-ing</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/02/13/sproutcore-first-impressions/">SproutCore - First Impressions</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/02/06/docker/">Docker</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/12/01/ec2-container-service/">EC2 Container Service</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/07/02/linux-awk/">Linux - AWK/GAWK</a>
      </li>
    
  </ul>
</section>

<section id="github-repos" class="aside-module grid__item one-whole lap-one-half">
  <h1 class="title delta">
    GitHub Repos
    
    <small class="pull-right">
      <a class="btn" href="//github.com/wrightcoder" title="@wrightcoder on GitHub" target="_blank">
        <i class="icon-external-link"></i>
      </a>
    </small>
    
  </h1>
  <ul id="gh_repos" class="divided">
    <li class="loading">
      <i class="icon-spinner icon-spin"></i>
    </li>
  </ul>
</section>




</div>

        </aside>
        
      </div>
    </div>
    
    <footer>
      <div class="grid-wrapper">
  <div class="grid">
    <div class="grid__item">
      <p class="copyright">
  All content by Michael Wright and licenced under <a href="//creativecommons.org/licenses/by-nc-sa/3.0/ie/">Creative Commons</a>.<br>
  Code under <a href="//github.com/coogie/oscailte/blob/master/README.md">MIT Licence</a>.
</p>
    </div>
  </div>
</div>

    </footer>

    <!--[if lt IE 7]>
      <p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to improve your experience.</p>
    <![endif]-->

    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>
<script src="//crypto-js.googlecode.com/svn/tags/3.1.2/build/rollups/md5.js"></script>
<script defer src="/javascripts/octopress.js"></script>




<script>
  var disqus_shortname = 'wrightcoder';
  
    
    // var disqus_developer = 1;
    var disqus_identifier = 'http://www.mikewright.me/blog/2014/12/01/ec2-container-service/';
    var disqus_url = 'http://www.mikewright.me/blog/2014/12/01/ec2-container-service/';
    var disqus_script = 'embed.js';
  
  (function () {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  }());
</script>




<script>
  $(document).ready(function(){
    if (!window.jXHR){
      var jxhr = document.createElement('script');
      jxhr.type = 'text/javascript';
      jxhr.src = '/javascripts/libs/jXHR.js';
      var s = document.getElementsByTagName('script')[0];
      s.parentNode.insertBefore(jxhr, s);
    }

    github.showRepos({
      user: 'wrightcoder',
      count: 0,
      skip_forks: true,
      target: '#gh_repos'
    });
  });
</script>
<script src="/javascripts/github.js"></script>






  </body>
</html>